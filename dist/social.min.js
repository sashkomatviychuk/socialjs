/*! Social - v0.1.0 - 2013-05-01
* https://github.com/ideil/socialjs
* Copyright (c) 2013 Ideil; Licensed MIT */
(function(t,e,r,n){function s(e,r){this.el=e,this.shareCount=n,this.$el=t(e),this.options=t.extend({},h,r),this._defaults=h,this._name=a,this.init()}var a="social",i={facebook:{shareUrl:"http://www.facebook.com/sharer.php?u={{pageUrl}}",countUrl:"http://graph.facebook.com/?ids={{pageUrl}}"},twitter:{shareUrl:"https://twitter.com/intent/tweet?source=tweetbutton&text={{pageUrl}}",countUrl:"http://urls.api.twitter.com/1/urls/count.json?url={{pageUrl}}",parseResponse:function(t){return t.count}},vk:{shareUrl:"http://vk.com/share.php?url={{pageUrl}}",countUrl:"http://vk.com/share.php?act=count&format=json&index=0&url={{pageUrl}}",preParse:function(t,r){e.VK=e.VK||{},e.VK.Share=e.VK.Share||{},e.VK.Share.count=function(e,n){return t.shareCount=n,t.$el.trigger("sharefetched",t.shareCount),"function"==typeof r&&r(t.shareCount),t.shareCount}}},pinterest:{shareUrl:"http://pinterest.com/pinthis/?url={{pageUrl}}",countUrl:"http://api.pinterest.com/v1/urls/count.json?url={{pageUrl}}",parseResponse:function(t){return t.count}},linkedin:{shareUrl:"http://www.linkedin.com/sharer.php?u={{pageUrl}}",countUrl:"http://www.linkedin.com/countserv/count/share?url={{pageUrl}}&format=jsonp",parseResponse:function(t){return t.count}},mailru:{shareUrl:"http://connect.mail.ru/share?url={{pageUrl}}",countUrl:"http://connect.mail.ru/share_count?callback=1&url_list={{pageUrl}}",ajaxParams:{jsonp:"func"}},odnoklassniki:{shareUrl:"http://www.odnoklassniki.ru/dk?st.cmd=addShare&st._surl={{pageUrl}}",countUrl:"http://www.odnoklassniki.ru/dk?st.cmd=extLike&ref={{pageUrl}}",preParse:function(t,r){e.ODKL=e.ODKL||{},e.ODKL.updateCount=function(e,n){return t.shareCount=parseInt(n,10),t.$el.trigger("sharefetched",t.shareCount),"function"==typeof r&&r(t.shareCount),t.shareCount}}}},o={type:"GET",dataType:"jsonp"},h={fetchCountOnInit:!1};s.prototype={init:function(){var t="";this.service=this.$el.attr("data-service"),this.pageUrl=this.$el.attr("data-href"),t=this.pageUrl?this.pageUrl:e.location.href,this.shareLink=i[this.service].shareUrl.replace("{{pageUrl}}",t),this.countLink=i[this.service].countUrl.replace("{{pageUrl}}",this.pageUrl),this.createLink(),h.fetchCountOnInit&&this.fetchShareCount()},createLink:function(){this.$el.attr("href",this.shareLink)},fetchShareCount:function(t){i[this.service].preParse&&i[this.service].preParse(this,t),this.fetchDeferredCount().success(function(e){this.parseCount(e),this.$el.trigger("sharefetched",this.shareCount),"function"==typeof t&&t(this.shareCount)})},fetchDeferredCount:function(){return t.ajax(t.extend(!0,{},o,i[this.service].ajaxParams,{url:this.countLink,context:this}))},parseCount:function(e){var r=this;i[r.service].parseResponse?r.shareCount=i[r.service].parseResponse(e):t.each(e,function(t,e){r.shareCount=e.shares!==n?e.shares:0})},getCurrentCount:function(){return this.shareCount}},t.fn[a]=function(e,r){var n=this,i=this.length;return r=r||!1,this.each(function(o){var h=t.data(this,"plugin_"+a);h?"function"==typeof h[e]&&(0===e.indexOf("get")&&(i>1?(0===o&&(n={}),n[h.service]=h[e](r)):n=h[e](r)),h[e](r)):t.data(this,"plugin_"+a,new s(this,e))}),n}})(jQuery,window,document);